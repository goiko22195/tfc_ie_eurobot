%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Generic template for TFC/TFM/TFG/Tesis
%
% $Id: introduccion.tex,v 1.6 2014/02/11 11:00:06 macias Exp $
%
% By:
%  + Javier Macías-Guarasa.
%    Departamento de Electrónica
%    Universidad de Alcalá
%  + Roberto Barra-Chicote.
%    Departamento de Ingeniería Electrónica
%    Universidad Politécnica de Madrid
%
% Based on original sources by Roberto Barra, Manuel Ocaña, Jesús Nuevo,
% Pedro Revenga, Fernando Herránz and Noelia Hernández. Thanks a lot to
% all of them, and to the many anonymous contributors found (thanks to
% google) that provided help in setting all this up.
%
% See also the additionalContributors.txt file to check the name of
% additional contributors to this work.
%
% If you think you can add pieces of relevant/useful examples,
% improvements, please contact us at (macias@depeca.uah.es)
%
% Copyleft 2013
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{El robot de Eurobot}
\label{cha:el_robot_de_eurobot}

\begin{FraseCelebre}
  \begin{Frase}
    Desocupado lector, sin juramento me podrás creer que quisiera que este
    libro [...] fuera el más hermoso, el más gallardo y más discreto que
    pudiera imaginarse\footnote{Tomado de ejemplos del proyecto \texis{}.}.
  \end{Frase}
  \begin{Fuente}
    Miguel de Cervantes, Don Quijote de la Mancha
  \end{Fuente}
\end{FraseCelebre}



\section{Introducción}

Cada robot que participa en Eurobot es único y diferente al resto, sin embargo todos tienen en común ciertas características o funcionalidades que vienen determinadas o derivadas de las reglas del juego. Como se ha comentado en el capitulo \ref{cha:introduccion} cada año la prueba en la que competir o a resolver es diferente, esto tiene una implicación directa en el diseño mecánico especialmente en los mecanismos diseñados para manipular los elementos de juego propios de la prueba. Sin embargo, si se comparan las reglas del juego de varios años se observan características comunes que repercuten en el diseño de la mecánica, de la electrónica o del software.

\section{Especificaciones del robot de Eurobot}
\label{sec:especificaciones_del_robot_de_eurobot}

Un robot de Eurobot tiene especificaciones independientes de la temática del juego y otras dependientes totalmente. Las primera permiten que una vez estén desarrolladas y validadas puedan ser reutilizadas o mejoradas en futuros diseños. Esto quiere decir que pueden ser un bloque totalmente modular, por ejemplo una tarjeta electrónica, o diseños reutilizables como el diseño electrónico de la tarjeta, cuyo PCB\footnote{Del inglés \emph{Printed Circuit Board}, Tarjeta de Circuito Impreso} puede diseñarse a medida del robot y en función del espacio disponible.

Por otro lado, los sistemas mecánicos a diseñar para la manipulación de los elementos de juego son en su mayoría específicos de cada prueba. Sólo una pequeña parte del desarrollo relacionado con estos sistemas es reutilizable, como es parte del desarrollo software destinado al control de dichos sistemas mecánicos. 

Un robot de Eurobot ha de ser completamente autónomo y básicamente ser capaz de:

\begin{enumerate}
\item Desplazarse hasta las diferentes zonas del campo donde se sitúan los elementos del juego o donde se almacenan.
\item Evitar chocar con elementos del campo de juego y con otros robots oponentes durante los desplazamientos entre zonas del campo.
\end{enumerate}

Además, si las reglas permiten dos robots por equipo: un robot principal y uno secundario, es recomendable que ambos robots sean capaces de comunicarse entre sí con el fin jugar de forma cooperativa.

Con el fin de facilitar la detección entre los robots y que estos sean capaces de evitar colisiones entre ellos, los robots han de reservar un espacio para sensores y balizas a una altura determinada como muestra la figura \ref{fig:balizas_robots}. Así, cada robot puede colocar una baliza o marca en el robot oponente y disponer de un espacio donde situar los sensores apropiados para detectar dicha baliza. 

Estas balizas pueden ser activas o pasivas. Por ejemplo, un sistema compuesto por una baliza maciza y un sensor de ultrasonidos puede ser utilizado para detectar a que distancia y dirección se encuentra un robot oponente antes de tomar tomar la decisión de hacia donde redirigirse.

Además el campo de juego cuenta con 3 soportes para balizas adicionales que están a disposición de cada equipo (ver figura \ref{fig:balizas_campo}). Estos soportes están pensados para facilitar la localización de los robots en el campo de juego. Por ejemplo, un sistema compuesto por una baliza reflectante colocada en el soporte de una esquina del campo y un sensor de luz reflexivo en el robot puede ser utilizado para localizar una canasta que se encuentre en dicha esquina del campo.

Las balizas pueden ser activas o pasivas y tiene como únicas restricciones sus dimensiones y peso:

\begin{itemize}
\item Balizas colocadas en el oponente: dimensiones máximas de 80x80x80 cm y peso máximo de 0,5 Kg.
\item Balizas del campo de juego: dimensiones máximas de 160x80x80 cm.
\item Espacio para sensores en cada robot: 80x80x80 cm. 
\end{itemize}

\begin{figure}[ht]
\centering
\includegraphics[height=.27\textheight]{balizas_robots}
\caption{Altura de balizas y sensores. Vista de perfil de dos robots oponentes y el campo de juego. 1- Soporte para balizas del campo de juego. 2- Soporte para baliza del oponente. 3- Espacio para sensores de balizas.}
\label{fig:balizas_robots}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[height=.27\textheight]{balizas_campo}
\caption{Campo de juego de Eurobot 2015. Soportes para balizas fijas de los equipos A y B.}
\label{fig:balizas_campo}
\end{figure}

Por otro lado, el robot ha de ser capaz de resolver la temática del juego lo cual implica el manejo de los elementos o piezas propias del juego. Por ejemplo, en Eurobot 2015, juego titulado como \emph{Robomovies} (temática sobre el cine), una de las cosas por las que los robots obtenían puntos era por hacer una torre con piezas cilíndricas coronada con una pelota de tenis que simbolizaba un foco de cine. 

Además, mecánicamente un robot ha de cumplir las siguientes restricciones dimensionales:

\begin{itemize}
\item Perímetro máximo inicial 1200 mm (700 mm para el robot secundario)
\item Perímetro máximo desplegado 1500 mm (900 mm para el robot secundario)
\item Altura máxima de 350 mm
\end{itemize}


Por último, las reglas de Eurobot además especifican otros temas que deben de ser tenidos en cuenta en caso de que apliquen:

\begin{itemize}
\item Fuentes de alimentación y baterías
\item Utilización de fuentes de luz y láseres
\item Utilización de sistemas de comunicación de radio
\item Utilización de sistemas de aire comprimido
\item Botón de parada de emergencia
\item Método de comienzo y finalización de un partido
\item Procedimientos de un partido.
\end{itemize}


\section{Partes principales en el desarrollo de un robot de Eurobot}

Teniendo en cuenta las especificaciones descritas en la sección anterior y la temática de la prueba de Eurobot, el desarrollo de un robot de Eurobot se puede dividir en las siguientes partes principales:

\begin{enumerate}
\item Estrategia de juego.
\item Desplazamiento y localización.
\item Evitación de obstáculos.
\item Comunicación entre robots (en caso de jugar con 2 robots).
\item Manipulación de elementos de juego. 
\end{enumerate}

Así, tal y como representa la figura \ref{fig:partes_robot_eurobot}, un único robot está compuesto por las tres primera partes y sólo en caso de contar con 2 o más robots es necesaria la parte de comunicación entre robots. 

\begin{figure}[h]
\centering
\includegraphics[height=.4\textheight]{partes_robot_eurobot}
\caption{Partes principales del desarrollo de un robot de Eurobot. En el fondo robot P.Tinto y Tirantes (robot secundario) desarrollados para Eurobot 2015 por el equipo Eurobotics Engineering}
\label{fig:partes_robot_eurobot}
\end{figure}

Por otro lado, las partes 2, 3 y 4 forman lo que se ha denominado \emph{plataforma robótica base}. Esta plataforma base está compuesta por las partes que permiten un desarrollo independientemente de la temática de la prueba de Eurobot. Así, esta plataforma robótica constituye un desarrollo reutilizable en la concepción de nuevos robots de Eurobot. 

Cada una de estas partes principales de un robot de Eurobot tienen pueden implicar un desarrollo mecánico, electrónico y de software, dependiendo del caso.


\subsection{Estrategia de juego}
\label{sec:estrategia_de_juego}

La estrategia de juego constituye el nivel más abstracto del robot y tiene un desarrollo puramente software. La estrategia tiene en cuenta diferentes variables del juego como se indica en la figura \ref{fig:variables_estrategia}(tareas por realizar, prioridad de tareas, posición del oponente, el tiempo transcurrido de partido, etc.) para tomar decisiones que maximicen la puntuación a conseguir y así ganar el partido.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{variables_estrategia}
\caption{Estrategia de juego: variables a tener en cuenta en la toma de decisiones.}
\label{fig:variables_estrategia}
\end{figure}

El desarrollo de la estrategia puede ser realizado en paralelo a otras partes del robot, pero ha de tener en cuenta los tiempos derivados de tareas que impliquen sistemas mecánicos, como por ejemplo coger una pelota y almacenarla o desplazarse de un punto del campo a otro. Dichos tiempos por lo general son mucho mayores (segundos o decenas de segundos) que el tiempo que tarda el algoritmo de estrategia implementado en tomar una decisión. Es por ello que dicho algoritmo estará la mayor parte del tiempo esperando a que otras partes terminen de realizar su función.

\subsection{Desplazamiento y localización}
\label{sec:desplazamiento_y_localizacion}

Un robot de Eurobot está diseñado para funcionar en un entorno de dimensiones conocidas como es el campo de juego (un área de 2x3 m), o lo que es lo mismo un plano cartesiano. Así la posición del robot y otros objetos del campo, como elementos de juego o los robots oponentes, vendrá dada por sus coordenadas rectangulares $(x,y)$ y polares $(d,a)$ relativas a un origen de coordenadas $(0,0)$ (ver figura \ref{fig:ejemplo_campo_cartesiano_y_trayectorias}).

La localización permite al robot conocer su posición $(x_R,y_R)$ en el campo y poder calcular las distancias (rectangulares o polares) de un punto de destino $(x_i,y_i)$ relativas a su posición. El desplazamiento permite recorrer dichas distancias a una velocidad $v$ y aceleración $a$ determinadas generando así \emph{trayectorias}.

\begin{figure}[h]
\centering
\includegraphics[height=.4\textheight]{ejemplo_campo_cartesiano_y_trayectorias}
\caption{Representación cartesiana del campo de Eurobot 2015 (ver figura \ref{fig:ejemplo_campo_cartesiano_y_trayectorias}) y ejemplo de generación de trayectorias. En horizontal el eje $x[mm]$, vertical el eje $y[mm]$. Los cuadrados rojos representan obstáculos y el cuadrado azul de rayas la zona útil de desplazamiento del robot. El punto azul grande con flecha indica la posición de inicio y los puntos azules grandes sin flecha indican un punto de destino. Los puntos azules pequeños indican puntos de la trayectoria.}
\label{fig:ejemplo_campo_cartesiano_y_trayectorias}
\end{figure}

Mecánicamente es necesario desarrollar un sistema de tracción, que en el caso de los robots desarrollados es un \emph{sistema de tracción diferencial}. Dicho sistema está compuesto por dos motores con reductora que mueven dos ruedas independientes que están en contacto con el campo de juego. Además para poder \emph{controlar velocidad y aceleración} de cada rueda se utilizan sensores tipo \emph{encoder} que miden cuanto gira cada rueda, o lo que es lo mismo su posición angular relativa. Utilizando la información medida por los encoders (u otro sistema similar) es posible medir la posición del robot de forma relativa a una posición de inicio mediante \emph{algoritmos de odometría}\footnote{De forma complementaria se pueden utilizar sistemas de medida de posición absoluta para corregir los errores de las medidas relativas}.

Como muestra la figura \ref{fig:desplazamiento_y_localizacion_bloques} la electrónica asociada ha de contar con una etapa de electrónica de potencia que permita la excitación de los motores (\emph{drivers} de motores), el acondicionamiento y decodificación de las señales de los encoders, y un microcontrolador donde se implementen los algoritmos de control de posición, velocidad y aceleración de los motores, y el algoritmo de odometría.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{desplazamiento_y_localizacion_bloques}
\caption{Desplazamiento y localización: diagrama de bloques del desarrollo mecánico, electrónico y software implicado.}
\label{fig:desplazamiento_y_localizacion_bloques}
\end{figure}

Dicho microcontrolador, además de implementar los algoritmos específicos de control de motores y odometría, ha de implementar funciones mucho más abstractas como la \emph{generación de trayectorias}. De forma que en última medida, el robot pueda desplazarse a un punto del campo de juego de forma autónoma o seguir un camino compuesto por varios puntos como el representado en la figura \ref{fig:ejemplo_campo_cartesiano_y_trayectorias}.

\subsection{Evitación de obstáculos}
\label{sec:evitacion_de_obstaculos}

El robot de Eurobot se encuentra con dos tipos de obstáculos a evitar en sus trayectorias. Por un lado están los obstáculos fijos y de posición conocida como pueden ser partes del campo de juego o elementos de juego al inicio del partido. Y por otro lado, objetos de posición desconocida como son los robots oponentes o elementos de juego que han sido movidos de su posición inicial.

La evitación de obstáculos está directamente relacionada con la generación de trayectorias del robot, teniéndose en cuenta previamente al calculo de la trayectoria a realizar y durante la misma. Los sistemas de detección de obstáculos a desarrollar dependen de las diferente situaciones que se dan en un partido de Eurobot:

\begin{description}
\item \textbf{Objetos en trayectorias de un punto a otro del campo}

Es el caso en el que el robot quiere ir de una zona del campo a otra, por ejemplo para coger o dejar un elemento de juego. El camino a seguir hasta la zona de destino ha de tener en cuenta los espacios libres del campo de juego y la posición de los robots oponentes para así seguir trayectorias libres de obstáculos. Como muestra el ejemplo de la figura \ref{ejemplo_trayectorias_y_evitacion}, entre el punto origen y destino además de los objetos fijos del campo de juego se encuentra el robot oponente. La generación de trayectorias tiene en cuenta estos obstáculos y genera trayectorias que rodean los obstáculos siguiendo el camino más corto.


\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{ejemplo_trayectorias_y_evitacion}
\caption{Evitación de obstáculos en trayectorias de una zona a otra del campo. En el centro un robot oponente. En horizontal el eje $x[mm]$, vertical el eje $y[mm]$. Los cuadrados rojos representan obstáculos y el cuadrado azul de rayas la zona útil de desplazamiento del robot. El punto azul grande con flecha indica la posición de inicio y los puntos azules grandes sin flecha indican un punto de destino. Los puntos azules pequeños indican puntos de la trayectoria.}
\label{fig:ejemplo_trayectorias_y_evitacion}
\end{figure}


La evitación los obstáculo fijos del campo de juego se puede realizar utilizando la \emph{localización del robot}. Si el robot conoce su posición es sencillo evitar chocar con paredes o elementos fijos del campo de juego.

Respecto a la evitación y detección de los robots oponentes es necesario desarrollar un sistema específico para ello. Este sistema normalmente utiliza los soportes de balizas especificado por las reglas de Eurobot (ver figura \ref{sec:especificaciones_del_robot_de_eurobot}). Dependiendo del sistema de balizas utilizado\ref{balizas_y_cerveza} el desarrollo del mismo implicará en mayor o mejor medida un desarrollo mecánico, electrónico o software. 

Sea cual sea el sistema utilizado para localizar al robot oponente, debe de aportar la información de la posición del éste de forma relativa a la posición del robot (ver ejemplo de la figura \ref{fig:medida_posicion_oponente} o absoluta respecto al origen de coordenadas del campo de juego. Además otras características deseables son un rango de detección que cubra todo el campo de juego y un tiempo de medición de la posición del oponente pequeño. El conocer en todo momento la posición del oponente constituye una información muy valiosa a tener en cuenta en la estrategia de juego. Así mismo, un tiempo de medición pequeño permitirá un menor tiempo de reacción en caso de peligro de colisión.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{medida_posicion_oponente}
\caption{Ejemplo de sistema de medida de la posición del robot oponente que utiliza una baliza colocada en el oponente y un sensor en el robot. La medida obtenida es el ángulo y la distancia relativa al la posición del robot.}
\label{fig:medida_posicion_oponente}
\end{figure}


\item \textbf{Objeto inesperado en una trayectoria}

Iniciada una trayectoria, que a priori no tiene obstáculos, en cualquier punto de esta puede ocurrir que el robot oponente cambie su posición y se interponga en el camino del robot pudiendo producirse una colisión. En este caso, el robot ha de detectar este obstáculo inesperado y parar o modificar su trayectoria para evitar la colisión.

La detección de un objeto inesperado en una trayectoria se puede realizar utilizando el mismo sistema desarrollado para localizar al robot oponente, si el rango de medida cubre distancias cercanas al robot y el tiempo de medida es suficientemente pequeño respecto a la velocidad de desplazamiento del robot. Aún así, un segundo sistema más especifico para estos casos aumenta la fiabilidad y permite hacer una doble comprobación si los rangos de detección de ambos sistemas se solapan.

El sistema a desarrollar permite detectar un objeto cercano (0 a 30cm aproximadamente) en las dirección de avance del robot (parte delantera y trasera) y opcionalmente detectar un objeto situado a los lados del robot (lado izquierdo y derecho). El rango depende de principalmente de la distancia de frenado del robot a velocidad máxima, de forma que la detección de un objeto permita evitar la colisión. 

Suelen utilizarse sensores digitales de luz difusa (luz roja o infrarrojos) situados estratégicamente a una altura determinada. En parte delantera y trasera del robot tres sensores son suficientes para detectar un objeto (dos si el robot es estrecho), dos de ellos se sitúan en los extremos de del robot y si fuera necesario un tercero en el punto medio entre ellos (ver figura \ref{fig:deteccion_obstaculo_en_trayectoria}). Para la detección de objetos a izquierda y derecha del robot un sensor a cada lado es suficiente. El fundamento es simple, si cualquiera de los dos sensores de los extremos de robot detecta un objeto hay posibilidad de colisión.

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{deteccion_obstaculo_en_trayectoria}
\caption{Ejemplo de sistema de detección de obstáculos en trayectoria. Tres sensores de corta distancia digitales detectan posibles colisiones.}
\label{fig:deteccion_obstaculo_en_trayectoria}
\end{figure}


\item \textbf{Objeto que bloquea un elemento del juego}

Caso en el que el robot se encuentra en una zona desde donde necesita acceder a un elemento de juego, por ejemplo un dispensador de fichas. Puede ocurrir que uno de los elementos de juego, por ejemplo una pelota u otro elemento, se encuentre entre el robot y el dicho dispensador. La probabilidad de que ocurra esto es mayor con los objetos esféricos y de poco peso, como por ejemplo pelotas de \emph{ping pong}, la manipulación de los mismos puede hacer que éstos rueden a lo largo del campo aleatoriamente con facilidad\footnote{Este tipo de objetos también puede entrar dentro de los sistemas mecánicos del robot e inutilízalos o bloquearlos}. 

Otro caso, que se suele dar muy pocas veces, es que el robot oponente esté protegiendo un elemento de juego común de forma premeditada utilizando otro elemento de juego, con el fin de dificultar su acceso al otro robot.

En el caso de que un objeto se encuentre entre un elemento fijo del campo, como una pared, y el robot. Si el robot necesita utilizar dicha pared como referencia y un objeto se encuentra en medio, la referencia que medirá el robot será errónea, así como los movimientos que realice respecto a esa referencia. Esta situación se puede prevenir si el robot es capaz de limpiar previamente la zona a la que quiere acceder realizando realizando secuencias de movimientos específicas para ello, o si el objeto bloqueante es detectado mediante sensores.

Una tercera forma de detectar un objeto bloqueante es utilizando la localización del robot, su posición y el error estimado de la misma. Si en el momento de tomar la referencia de la pared la posición medida por la localización del robot es mayor que el error estimado (en distancia o ángulo) algo está impidiendo llegar hasta la posición de referencia.

\end{description}

\subsection{Comunicación entre robots}
\label{sec:comunicacion_entre_robots}

En caso de disponer de dos robots por equipo hay diferentes formas de implementar una estrategia coordinada:

\begin{enumerate}
\item Que cada robot tenga asignado una zona de forma que no se estorben.
\item Que cada robot se mueva libremente por todo el campo y considere al robot compañero como un obstáculo más.
\item Que exista una comunicación entre ambos de forma que cada uno conozca la posición del otro trabajen en cualquier zona del campo pero sin estorbarse.
\end{enumerate}

Las dos primeras formas no implican un desarrollo añadido, los mismos sistemas de localización, desplazamiento y evitación de obstáculos desarrollados para un robot pueden replicarse en un segundo robot sin apenas coste añadido, excepto por aquel derivado de sus características mecánicas (diferente dimensiones, motores, sistemas mecánicos...).

La tercera forma necesita del desarrollo de un sistema de comunicación entre ambos robots. Esto implica un desarrollo electrónico y de software principalmente. Es recomendable utilizar una tecnología que robusta y flexible que incluya capas de comunicación que aseguren una fiabilidad en la comunicación. Sobre todo porque el entorno en el que se desarrollan las competiciones suele tener muchas perturbaciones de radio frecuencia como equipos de audio y vídeo inalámbricos, redes Wifi o Bluetooth que pueden afectar a la comunicaciones entre los robots. 

Como representa la figura \ref{}, cada robot necesita de un modulo de comunicación conectado a un microcontrolador. Bluetooth y Zigbee son dos de las tecnologías más utilizadas en comunicación inalámbrica, existen en el mercado módulos de comunicación de estas tecnologías que permiten crear enlaces de comunicación de forma sencilla. Dichos módulos electrónicos suelen tener una interfaz serie de comunicación (UART, SPI, I2C, ...) de forma que una vez establecido el canal de comunicación inalámbrico la comunicación entre dos microcontroladores es trasparente (similar a tener un canal cableado). 

Por la parte del software, es necesario desarrollar un protocolo de comunicación, común a los dos robots, a partir del cual enviar y/o recibir mensajes entre ellos.




\subsection{Manipulación de elementos de juego} 
\label{sec:manipulación_de_elementos_de_juego}

\section{Fases y metodología de diseño}

\begin{itemize}
\item Enfoque del proyecto y los esfuerzos: desarrollar un robot vs. desarrollar un sensor.
\item Desde la inexperiencia
\item Grano fino / grano grueso
\item Grano grueso puede limitar el diseño mecánico
\end{itemize}

\section{Depuración y puesta en marcha}

Pruebas en campo costoso, todo lo no dependiente de la mecanica simulado.


%%% Local Variables:
%%% TeX-master: "../book"
%%% End:
