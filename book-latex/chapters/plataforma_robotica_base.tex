t%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Generic template for TFC/TFM/TFG/Tesis
%
% $Id: introduccion.tex,v 1.6 2014/02/11 11:00:06 macias Exp $
%
% By:
%  + Javier Macías-Guarasa.
%    Departamento de Electrónica
%    Universidad de Alcalá
%  + Roberto Barra-Chicote.
%    Departamento de Ingeniería Electrónica
%    Universidad Politécnica de Madrid
%
% Based on original sources by Roberto Barra, Manuel Ocaña, Jesús Nuevo,
% Pedro Revenga, Fernando Herránz and Noelia Hernández. Thanks a lot to
% all of them, and to the many anonymous contributors found (thanks to
% google) that provided help in setting all this up.
%
% See also the additionalContributors.txt file to check the name of
% additional contributors to this work.
%
% If you think you can add pieces of relevant/useful examples,
% improvements, please contact us at (macias@depeca.uah.es)
%
% Copyleft 2013
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Plataforma robótica base}
\label{cha:plataforma_robotica_base}

\begin{FraseCelebre}
  \begin{Frase}
La imaginación es más importante que el conocimiento. El conocimiento es limitado y la imaginación circunda el mundo.    
  \end{Frase}
  \begin{Fuente}
Albert Einstein, en \emph{The Saturday Evening Post}
  \end{Fuente}
\end{FraseCelebre}


\section{Introducción}

En este capítulo se presenta la plataforma robótica base desarrollada y utilizada en los robots desarrollados a partir del año 2010. La plataforma implementa las tres funcionalidades básicas de un robot de Eurobot (ver capitulo \ref{cha:el_robot_de_eurobot}, sección \ref{sec:partes_robot_eurobot}):

%Se describen las características mecánicas, electrónicas y de software implicadas en su desarrollo, así como lo fundamentos de ingeniería sobre los que se apoya. 

\begin{itemize}
\item Desplazamiento y localización
\item Evitación de obstáculos
\item Comunicación entre robots
\end{itemize}

Y se compone de los siguientes sistemas:

\begin{enumerate}
\item Sistema de tracción diferencial
\item Sistema de control de posición polar
\item Sistema de generación de trayectorias
\item Sistema de detección de obstáculos
\item Sistema de evitación de obstáculos
\item Sistema de comunicación entre robots
\end{enumerate}

\section{Sistema de tracción diferencial}
\label{sec:sistema_traccion_diferencial}

El sistema de tracción desarrollado es uno de los más comunes en Eurobot. Como muestra la figura \ref{fig:sistema_traccion}, se trata de un sistema de tracción diferencial compuesto por dos ruedas motrices unidas a motores mediante una reductora y al menos 2 puntos de apoyo (dependiendo de la posición del eje motriz). La excitación de los motores la tarjeta electrónica desarrollada \emph{Eurobotics 2010}.

En este caso el eje motriz se encuentra centrado en la base del robot y necesita 4 puntos de apoyo. En caso de que el eje motriz se encuentre situado en uno de los extremos del robot se necesita dos puntos de apoyo situados en el extremo opuesto.

\begin{figure}[ht]
\centering
\includegraphics[height=.3\textheight]{sistema_traccion}
\caption[Sistema de tracción diferencial]{Sistema de tracción diferencial de la plataforma robótica base. Robot Zamorano (Eurobot 2011).}
\label{fig:sistema_traccion}
\end{figure}

\subsection{Dinamica básica}
\label{sec:dinamica_basica}

Tal y como describe el equipo RCVA en \cite{rcva_10x}, el modelo en las fases de aceleración, velocidad constante y deceleración de un robot de tracción diferencial y dos puntos de apoyo que se desplaza por el plano horizontal, queda representado por la figura siguiente:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{dinamica_basica}
\caption[Modelo dinámico simple de un robot de tracción diferencial]{Modelo dinámico simple de un robot de tracción diferencial.}
\label{fig:dinamica_basica}
\end{figure}

Siendo:

$Fn$: fuerza normal o vertical del suelo en la rueda (opuesta a la fuerza de apoyo debida al peso del robot)

$Fx$: fuerza de propulsión de en la rueda

$F$: fuerza resultante del suelo en la rueda

$a$: aceleración del robot

$m$: masa del robot sobre las ruedas.

Considerando que el centro de gravedad del robot se encuentra sobre el eje motriz, durante la fase de aceleración ($a>0$) $Fx$ es positiva y la masa del robot se encuentra repartida entre las ruedas y los puntos de apoyo. Durante la fase de velocidad constante ($a=0$) la fuerza de propulsión es nula siendo la fuerza resultante igual a la fuerza normal. Por último, durante la fase de frenado ($a<0$) la fuerza $Fx$ es negativa y la masa del robot esta sobre las ruedas debido a la dirección de la fuerza de propulsión $F$. 


\subsection{Coeficiente de adherencia de las ruedas y su cálculo experimental}
\label{coeficiente_adherencia_y_calculo_experimental}

A partir del modelo dinámico descrito anteriormente, teniendo en cuenta que el robot dispone de dos ruedas (un motor por rueda) y a partir de la primera ley de Newton se deduce que la aceleración $a$ del robot es

\begin{equation}
  \label{eq:a_f_fx}
  a = \frac{2Fx}{m}
\end{equation}


La aceleración máxima vendrá dada por la fuerza de propulsión de las ruedas máxima $Fx_{max}$ a partir de la cual se produce el deslizamiento de las ruedas. Por lo tanto $Fx<Fx_{max}$, siendo 

\begin{equation}
  \label{eq:fx_max_f_ka}
  Fx_{max} = Ka \, Fn
\end{equation}

donde $Ka$ es el coeficiente de adherencia de las ruedas contra el suelo y sus valores teóricos se encuentran ente 0 y 1:

$Ka=0$: adherencia nula

$Ka=1$: adherencia teórica máxima\footnote{En la practica el coeficiente de adherencia puede superar valores de uno, por ejemplo si existe una carga aerodinámica extra como ocurre en los coches de carreras de la F1.}.

El valor de $Ka$ depende del tipo de neumático utilizado y de la calidad del campo de juego. Así para un neumático consistente en una junta tórica se consiguen valores de $Ka$ inferiores a $0,5$, en cambio un neumático de caucho de baja dureza (entre 20 y 30 shores) podría alcanzar valores de $Ka$ cercanos a 1. 

El coeficiente de adherencia permite calcular, junto con la posición del centro de gravedad del robot, la aceleración máxima del robot. El valor del coeficiente de adherencia se puede medir mediante el método propuesto en \cite{rcva_10x}, conocido como el \emph{método del cubo}. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{metodo_cubo}
\caption[]{Medodo de medida del coeficiente de adherencia de las ruedas.}
\label{fig:metodo_cubo}
\end{figure}


El método se encuentra representado en la figura \ref{fig:metodo_cubo} y consta de tres pasos:

\begin{enumerate}
\item Apoyar las ruedas del robot sobre la báscula manteniendo el robot horizontal. Ayudarse de un soporte sobre los puntos de apoyo del robot. El peso $P1$ se corresponde con la fuerza con la que las ruedas apoyan en el suelo.
\item Bloquear las ruedas del robot bloqueadas\footnote{El boqueo ha de ser un bloqueo mecánico, en caso de bloquear las ruedas manteniendo la consigna de posición del robot el motor puede resultar gravemente dañado.}. Fijar mediante una cuerda un cubo a la parte más baja y  cercana al eje motriz del robot. Hacer pasar la cuerda por una polea para disminuir el rozamiento. Añadir peso al cubo hasta que las ruedas comiencen a deslizar.
\item Medir el peso del cubo $P2$, correspondiente a la fuerza de tracción máxima en el límite de deslizamiento.
\end{enumerate}

El coeficiente de adherencia viene dado por las medidas realizadas según la expresión

\begin{equation}
  \label{eq:ka=f(p1,p2)}
  \boxed{Ka = \frac{P2}{P1}}.
\end{equation}

siendo el valor de $Ka$ es independiente del peso del robot.

TODO: ejemplo robots Eurobotics...


\subsection{Determinación de la aceleración máxima en fases de aceleración y frenado}

A partir de la posición del centro de gravedad del robot y el coeficiente de adherencia al suelo de la ruedas motrices es posible calcular la aceleración máxima que en caso de superarse producirá un deslizamiento de las ruedas o que el robot se levante haciendo \emph{el caballito}.

Un robot con tracción diferencial permite dos tipos de configuraciones:

\begin{enumerate}
\item Robot con ruedas atrás.
\item Robot con ruedas en el medio simétrico.
\item Robot con ruedas en el medio no simétrico.
\end{enumerate}

El estudio de el valor máximo de aceleración durante las fases de aceleración y frenado para los dos primeros casos se realiza en \cite{rcva_10x}. El estudio del tercer caso es aportado por este trabajo.

El estudio parte del modelo dinámico del robot representado por la siguiente figura:

\begin{figure}[H]
\centering
\includegraphics[width=.5\textwidth]{dinamica_a_max_ruedas_atras}
\caption[]{Modelo dinámico fase de aceleración y frenado para robots con ruedas atrás y dos puntos de apoyo.}
\label{fig:dinamica_a_max_ruedas_atras}
\end{figure}

Donde:

$G$: centro de gravedad del robot.

$Fx$: fuerza de propulsión de en la rueda.

$F1$: fuerza normal del suelo en la rueda.

$F2$: fuerza normal del suelo en el punto delantero.

$a$: aceleración del robot

$-mg$: fuerza de la gravedad aplicada en el centro de gravedad.

$d1$:  distancia entre el centro de gravedad y el eje motriz.

$d2$: distancia entre el centro de gravedad y el punto de apoyo delantero.

$d$: distancia entre el eje motriz y un punto de apoyo (d = d1 + d2).

$h$: altura del centro de gravedad del robot.


A partir de las relaciones de la mecánica que garantizan que el sistema está en equilibrio.

Suma de fuerzas verticales:
\begin{equation}
\label{eq:suma_fuerzas_verticales}
2F1 + 2F2 - mg = 0
\end{equation}

Suma de fuerzas horizontales:
\begin{equation}
\label{eq:suma_fuerzas_horizontales}
2Fx = ma
\end{equation}

Suma de torsiones aplicadas al punto G
\begin{equation}
\label{eq:suma_torsiones_punto_g}
F2d2 - F1d1 + Fx \, h = 0
\end{equation}

Se obtienen las ecuaciones que representan la distribución de pesos en las fases de aceleración y frenado:

\begin{align}
\label{eq:distribucion_pesos}
(2F1)/mg &= d2/d + (a/g)(h/d)\\
(2F2)/mg &= d1/d - (a/g)(h/d)
\end{align}

Donde $(2F1)/mg$ representa la distribución de pesos en el eje motriz, $(2F2)/mg$ representa el reparto de pesos en la parte delantera, $d2/d$ y $d1/d$ representan las distribuciones de pesos en estático ($a=0$), y $(a/g)(h/d)$ representa la transferencia de masa del robot.

Así pues, en fase de aceleración ($a>0$) la transferencia de masa se produce hacia la parte trasera del robot por lo que el robot avanza y tiende a hacer \emph{el caballito}. Mientras que en la fase de frenado ($a<0$) la transferencia de masa se produce hacia la parte delantera de forma que las ruedas tienen a deslizar o derrapar sobre el suelo.

La condición para no derrapar en la fase de aceleración viene dada por la ecuación \eqref{eq:fx_max_f_ka} expresada como 

\begin{equation}
\label{eq:condicion_derrape_aceleracion}
Fx < Ka \, F1
\end{equation}

y para la fase de frenado como

\begin{equation}
\label{eq:condicion_derrape_frenada}
|Fx| < Ka \, F1.
\end{equation}


Por otro lado, la condición para que el robot no haga \emph{el caballito} durante la fase de aceleración es

\begin{equation}
\label{eq:condicion_caballito_aceleracion}
F2 > 0
\end{equation}

y para la fase de frenado es

\begin{equation}
\label{eq:condicion_caballito_frenado}
F1 > 0
\end{equation}

A partir de las ecuaciones \eqref{eq:distribucion_pesos}, \eqref{eq:suma_fuerzas_horizontales} y las condiciones mencionadas anteriormente se obtienen las aceleraciones máximas para cada fase y condición.

Fase de aceleración ($a>0$):
\begin{empheq}[box=\fbox]{align}
\label{eq:a_max_aceleracion}
a_{max1} &= g\,\frac{Ka \, d2}{d-(Ka \, h)}\\
a_{max2} &= g\,\frac{d1}{h}
\end{empheq}


Fase de frenado ($a<0$):
\begin{empheq}[box=\fbox]{align}
\label{eq:amax_frenado}
a_{max1} &= g\,\frac{Ka \, d2}{d+(Ka \, h)}\\
a_{max2} &= g\,\frac{d2}{h}
\end{empheq}

Siendo $a_{max1}$ la aceleración máxima para no derrapar y $a_{max2}$ la aceleración máxima para no hacer \emph{el caballito}. Para cada fase la aceleración máxima vendrá dada por el valor mínimo de estas:

\begin{equation}
\label{eq:a_aceleracion}
a_{max} = Min\{a_{max1}, a_{max2}\}.
\end{equation}


La figura \ref{fig:ejemplo_a_max} representa el caso de dos robots con ruedas atrás iguales excepto por la altura de su centro de gravedad.


Los valores del cálculo de las aceleraciones máximas para estos robots se muestran en la tabla \ref{tab:ejemplo_a_max}.

\begin{table}[h]
\centering
\caption{Ejemplo de aceleraciones máximas en función del centro de gravedad}
\label{tab:ejemplo_a_max}

\begin{tabular}{ c|c|c|c|c| }
\cline{2-5}
			&\multicolumn{2}{c}{Robot 1} & \multicolumn{2}{|c|}{Robot 2} \\
\cline{2-5}
			& Aceleración & Frenado & Aceleración & Frenado \\
\cline{1-5}
\multicolumn{1}{|c|}{$a_{max1}$} 	& $1,2g$ 		& $0,4g$ 		& $3g$ 			& $0,3g$ 	\\
\multicolumn{1}{|c|}{$a_{max2}$} 	& $0,8g$ 		& $1,2g$ 		& $0,5g$ 		& $0,75g$ 	\\
\hline
\multicolumn{1}{|c|}{$a_{max}$} 	& $0,8g$ 		& $0,4g$ 		& $0,5g$ 		& $0,3g$ 	\\
									& $~8\,m/s$ 	& $~4\,m/s$ 	& $~5\,m/s$ 	& $~3\,m/s$ 	\\
\hline
\end{tabular}
\end{table}

Observar que estos cálculos sólo se refieren a desplazamientos de translación y no a giros, permitiendo maximizar la aceleración. Que el robot sea capaz de alcanzar dicha aceleración va a depender de la elección de los motores y su reductora.

Por otro lado, hay que tener en cuenta que estos cálculo dependen únicamente del centro de gravedad del robot y del coeficiente de adherencia de las ruedas. El peso del robot no interviene.

En conclusión:

\begin{itemize}
\item Interesa tener el máximo apoyo en el eje motriz aumentando el termino $(2F1)/mg$, o el termino estático $d2/d$, de forma que el centro de gravedad esté lo más cerca posible del eje motriz.

\item Cuando la transferencia de masa dinámica $(a/g)(h/d)$ cambia de signo debido a la aceleración, se consiguen una buena fase de deceleración pero una fase de frenado peor.

\item Como los robots en un partido no hacer otra cosas que acelerar y frenar, interesa reducir lo máximo la transferencia de masa que depende únicamente de la relación $(h/d)$. Por lo tanto interesa bajar el centro de gravedad.
\end{itemize}


Para los casos de un robot con ruedas en el medio los modelos dinámicos correspondientes se representan en la siguiente figura:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{dinamica_a_max_ruedas_medio}
\caption[]{Modelo dinámico fase de aceleración y frenado para robots con ruedas en el medio y cuatro puntos de apoyo.}
\label{fig:dinamica_a_max_ruedas_medio}
\end{figure}

Donde:

$G$: centro de gravedad del robot.

$Fx$: fuerza de propulsión de en la rueda.

$F1$: fuerza normal del suelo en la rueda.

$F2$: fuerza normal del suelo en el punto delantero.

$F3$: fuerza normal del suelo en el punto de apoyo trasero.

$a$: aceleración del robot

$-mg$: fuerza de la gravedad aplicada en el centro de gravedad.

$d1$: distancia entre el centro de gravedad y el eje motriz.

$d2$: distancia entre el centro de gravedad y el punto de apoyo trasero.

$d2'$: distancia entre el centro de gravedad y el punto de apoyo delantero.

$h$: altura del centro de gravedad del robot.



A partir del modelo de robot simétrico de la figura \ref{fig:dinamica_a_max_ruedas_atras} y siguiendo un análisis igual al realizado para robots con ruedas en un extremo, en \cite{rcva_10x0}, se obtienen las ecuaciones que definen las aceleraciones máximas para el caso del robot simétrico. Debido a que el robot tiene 4 puntos de apoyo no es posible que el robot haga \emph{el caballito}, la aceleración máxima vendrá dada únicamente para la condición de derrape de las ruedas y es la misma para las fases de aceleración y frenado dada la simetría del robot:

 
\begin{equation}
\label{eq:a_max_simetrico}
\boxed{a_{max} = g\,\frac{Ka}{1 + Ka\,(h/d2)}}
\end{equation}


Se ha estudiado el tercer caso en el que no existe una simetría y el centro de gravedad cae entre el eje motriz y los puntos de apoyo de uno de los extremos del robot. Al igual que en el caso anterior la condición de hacer \emph{el caballito} no existe al tener el robot 4 puntos de apoyo. Sin embargo, la aceleración máxima es distinta dependiendo la fase de aceleración o frenado debido a la asimetría.

Fase de aceleración ($a>0$):
\begin{equation}
\label{eq:a_max_pos_no_simetrico}
\boxed{a_{max} = g\,\frac{Ka}{(d1+d2)/d2 + Ka\,(h/d2)}}
\end{equation}


Fase de frenado ($a<0$):
\begin{equation}
\label{eq:a_max_neg_no_simetrico}
\boxed{a_{max} = g\,\frac{Ka}{(d2'-d1)/d2' + Ka\,(h/d2')}}
\end{equation}

Se comprueba que si $d1=0$, el modelo se corresponde con el de un robot simétrico y las equaciones \eqref{eq:a_max_pos_no_simetrico} y \eqref{eq:a_max_neg_no_simetrico} coinciden con la ecuación \eqref{eq:a_max_simetrico} del dicho modelo.



%Recordamos que estos cálculos sólo se refieren a los desplazamientos de translación
%no a giros. Estos cálculos permiten maximizar la aceleración en terminos de
%rendimiento máximo. Más adelante veremos como escoger una reductora capaz de
%entregar esta aceleración.
%Tenga en cuenta que la simplicidad de estos calculos sólo dependen de la posición
%del centro de gravedad y el coeficiente de fricción de las ruedas del suelo. En
%particular el peso del robot no interviene, lo que parecía obvio a priori.

%Nos llevan a las siguientes conclusiones:
%Interesa tener el máximo apollo en el eje motriz, aumentando así en la medida de lo
%posible el termino (2.F1)/m.g, es el termino estático d2/d, lo que lleva el centro de
%gravedad más cerca del eje de las ruedas.
%Cuando la transferencia de masa dinámica (a/g).(z/g) cambia de signo por la
%aceleración, se consigue una buena fase de aceleración pero una detestable fase de
%frenado.
%Como los robots en los partidos no hacen mas que acelerar y frenar, parece
%razonable que se reduzca tanto como sea posible la transferencia de masa que
%15
%depende sólo de la relación (z/d), es decir bajando el centro de gravedad.

%Para evitar el deslizamiento debido a errores del cálculo de ka, se recomienda utilizar
%un factor de seguridad (por ejemplo 0,8. a_ max).

\subsection{Perfil de velocidad trapezoidal}


\subsection{Leyes mecánicas y térmicas de un motor DC}
\subsection{Condición de deslizamiento y dimensionamiento de la reductora}
\subsection{Elección de la velocidad y la aceleración}

\section{Sistema de control de posición}
\label{sec:sitema_posicionamiento_relativo}


El control de los motores se realiza de forma indirecta utilizando las medida de posición de las ruedas libres.


Esta configuración difiere de la configuración clásica en la que el encoder se encuentra conectado directamente al eje del motor. Dichas ruedas libres se utilizan para implementar el sistema de posicionamiento mediante odometría, la configuración del encoder desacoplado del motor permite mejorar el error acumulado de posicionamiento debido al derrape de las ruedas motrices.



El desplazamiento del robot debido a las ruedas motrices es medida mediante encoders conectados a ruedas libres alineadas con las ruedas motrices. De esta forma se mide la posición de cada motor de forma indirecta e independiente de si las ruedas de tracción derrapan.


Al no estar conectado el encoder directamente al eje del motor, la medida obtenida es independiente de la tracción de la rueda con el el suelo. 




El control de posición es de tipo polar, es decir la posición del robot en todo momento viene dada por su distancia $d$ y ángulo $a$ absoluto respecto a un origen de coordenadas. 

\subsection{Control en posición de tipo polar}
\label{sec:control_posicion_tipo_polar}
\subsection{Ajuste del controlador PID}

\subsection{Detección de bloqueos mecánicos}
\label{sec:deteccion_bloqueos_mecanicos}



\subsection{Posicionamiento relativo mediante odometría}
\label{sec:posicionamiento_relativo_mediante_odometria}

\subsection{Medida y corrección de errores sistemáticos}
\subsection{Compensación de la fuerza centrípeta}



\section{Sistema de detección de obstáculos}
\label{sec:sistema_deteccion_obstaculos}

\subsection{Sistemas detección de obstáculos}
\subsection{Detección de oponentes mediante baliza tipo faro}




\section{Sistema de generación de trayectorias}
\label{sec:generacion_de_trayectorias}

\section{Sistema de evitación de obstáculos}
\label{sec:evitacion_de_obstaculos}






%%% Local Variables:
%%% TeX-master: "../book"
%%% End:
