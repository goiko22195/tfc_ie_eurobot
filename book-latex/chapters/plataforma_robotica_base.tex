t%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Generic template for TFC/TFM/TFG/Tesis
%
% $Id: introduccion.tex,v 1.6 2014/02/11 11:00:06 macias Exp $
%
% By:
%  + Javier Macías-Guarasa.
%    Departamento de Electrónica
%    Universidad de Alcalá
%  + Roberto Barra-Chicote.
%    Departamento de Ingeniería Electrónica
%    Universidad Politécnica de Madrid
%
% Based on original sources by Roberto Barra, Manuel Ocaña, Jesús Nuevo,
% Pedro Revenga, Fernando Herránz and Noelia Hernández. Thanks a lot to
% all of them, and to the many anonymous contributors found (thanks to
% google) that provided help in setting all this up.
%
% See also the additionalContributors.txt file to check the name of
% additional contributors to this work.
%
% If you think you can add pieces of relevant/useful examples,
% improvements, please contact us at (macias@depeca.uah.es)
%
% Copyleft 2013
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Plataforma robótica base}
\label{cha:plataforma_robotica_base}

\begin{FraseCelebre}
  \begin{Frase}
La imaginación es más importante que el conocimiento. El conocimiento es limitado y la imaginación circunda el mundo.    
  \end{Frase}
  \begin{Fuente}
Albert Einstein, en \emph{The Saturday Evening Post}
  \end{Fuente}
\end{FraseCelebre}


\section{Introducción}

Una plataforma robótica base permite desarrollar robots de Eurobot desde

En el año 2010 se desarrolló una plataforma robótica base, cuyo diseño fue reutilizado en el desarrollo de robots posteriores. 


Dicha plataforma implementa las funcionalidades básicas de un robot de Eurobot vistas en  la sección \ref{sec:partes_robot_eurobot} del capitulo \ref{cha:el_robot_de_eurobot}.:

\begin{itemize}
\item Desplazamiento y localización
\item Evitación de obstáculos
\item Comunicación entre robots
\end{itemize}

\section{Partes de la plataforma robótica}
\label{sec:partes_plataforma_robotica}

La plataforma robótica desarrollada se compone de un \emph{sistema de tracción diferencial}, un \emph{sistema de control de posición}, y un \emph{sistema de evitación de obstáculos}. La plataforma también incluye una electrónica con capacidad de gestionar e implementar estos sistemas y los sistemas mecánicos a diseñar específicamente para la prueba de Eurobot. Además, la electrónica dispone de una interfaz inalámbrica que permite comunicar dos robots basados en la misma plataforma robótica. 

El sistema de tracción diferencial lo compone un bloque motor formado por dos motores unidos mediante una reductora mecánica a dos ruedas (ver figura \ref{fig:plataforma_partes_1}). Sobre el eje motriz, en sus extremos, el robot tiene dos ruedas libres conectadas a sensores tipo encoder que se utilizan para implementar un \emph{sistema de posicionamiento por odometría} y, junto con el bloque motor, el control de posición polar.

\begin{figure}[h]
\centering
\includegraphics[height=.3\textheight]{plataforma_partes_1}
\caption[Plataforma robótica base: partes del sistema de tracción diferencial y del sistema de control de posición]{Plataforma robótica base: partes del sistema de tracción diferencial y del sistema de control de posición. Robot Zamorano (Eurobot 2011).}
\label{fig:plataforma_partes_1}
\end{figure}

La electrónica se compone principalmente de una fuente de alimentación de 24V, la \emph{tarjeta Eurobotics 2010} y tarjetas de expansión de entradas y salidas. 

El sistema de evitación de obstáculos está compuesto por varios sensores de corto alcance situados en las caras del robot (ver figura \ref{fig:plataforma_partes_2}) y un sistema de detección del oponente de largo alcance basado en un sensor tipo faro y balizas reflectantes (ver figura \ref{fig:plataforma_partes_2}.

\begin{figure}[h]
\centering
\includegraphics[height=.3\textheight]{plataforma_partes_2}
\caption[Plataforma robótica base: partes del sistema de evitación de obstáculos]{Plataforma robótica base: partes del sistema de evitación de obstáculos. Robot Zamorano (Eurobot 2011).}
\label{fig:plataforma_partes_2}
\end{figure}

La implementación de todos los sistemas y funcionalidades la plataforma robótica ha sido realizada a partir de las librerías Aversive4dspic. Estas librerías han sido migradas de las librerías Aversive \cite{aversive_src} (microcontroladores AVR) a microcontroladores dsPIC y PIC24.


\section{Sistema de tracción diferencial}
\label{sec:sistema_traccion_diferencial}
El sistema de tracción diferencial es uno de los más comunes en Eurobot, está compuesto por dos ruedas motrices unidas a motores mediante una reductora y varios puntos de apoyo (ver figura \ref{fig:plataforma_partes_1}). 

Dependiendo de la posición del eje motriz se dan 2 tipos de robots:

\begin{enumerate}
\item Robot con ruedas atrás: necesitan de dos puntos de apoyo delanteros.
\item Robot con ruedas en el medio: necesitan de puntos de apoyo delanteros y traseros.
\end{enumerate}

Los robots con ruedas atrás suelen tener dos puntos de poyo delanteros. En cambio, los robots con ruedas en el medio suelen tener dos puntos de apoyo delanteros y otros dos traseros. Aunque a veces en uno de los extremos sólo llevan un punto de apoyo, 3 puntos de apoyo en total.

Como se verá más adelante, interesa un robot con ruedas en el medio y que tenga una simetría total de forma que todo el peso del robot recaiga sobre el eje motriz. Además, los puntos de apoyo han de estar a la mayor distancia posible del eje motriz. Esta situación no siempre se cumple, ya que existe un compromiso con el resto de elementos mecánicos del robot.

Los puntos de apoyo utilizados normalmente son de tipo \emph{rollon}. En caso de no disponer de espacio suficiente para ellos también es posible utilizar materiales de bajo coeficiente de rozamiento como el teflón (ver figura \ref{fig:sistema_traccion_rollones}).

\begin{figure}[h]
\centering
\includegraphics[height=.3\textheight]{sistema_traccion_rollones}
\caption[]{Sistema de tracción diferencial del robot Automático (Eurobot 2013) visto desde abajo.}
\label{fig:sistema_traccion_rollones}
\end{figure}

Mecánicamente el conjunto de los motores, reductora y ruedas se denomina \emph{bloque motor}. El bloque motor se reutiliza como una parte independiente en cada diseño de un nuevo robot de forma que se sitúa sobre la base del robot adaptándose al resto de la mecánica.


\subsection{Dinamica básica}
\label{sec:dinamica_basica}

Es importante entender la dinámica de un robot de Eurobot y tenerla en cuenta durante el diseño mecánico del mismo. El movimiento más común de un robot de Eurobot son los desplazamientos entre dos puntos. Durante dichos desplazamientos el robot parte de parado, recorre una distancia y vuelve a detenerse. Así, a cada desplazamiento le corresponde una fase de aceleración, una fase de velocidad constante y otra fase de frenado.

Para el caso de un robot con ruedas atrás y dos puntos de apoyo, el modelo dinámico del robot, según describe el equipo RCVA en \cite{rcva_10x}, queda representado por la figura siguiente:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{dinamica_basica}
\caption[Modelo dinámico simple de un robot de tracción diferencial]{Modelo dinámico simple de un robot de tracción diferencial.}
\label{fig:dinamica_basica}
\end{figure}

Siendo:
\begin{description}
\item $F_n$: fuerza normal o vertical del suelo (opuesta a la fuerza de apoyo debida al peso del robot)
\item $F_x$: fuerza de propulsión de en la rueda
\item $F$: fuerza resultante del suelo en la rueda
\item $a$: aceleración del robot
\item $m$: masa del robot sobre las ruedas.
\end{description}

Durante la fase de aceleración ($a>0$) se necesita una fuerza de propulsión $F_x$ positiva de forma que la fuerza resultante $F$ provoque un desplazamiento hacia delante. Una vez alcanzada la fase de velocidad constante ($a=0$), teóricamente no es necesario realizar ninguna fuerza de propulsión\footnote{En la práctica, dado que existen perdidas por rozamiento $F_x$ no es nula} y la fuerza resultante es igual a la fuerza normal sobre la rueda. En la última fase, la fuerza de tracción $F_x$ ha de ser negativa de forma que la fuerza resultante se oponga al movimiento del robot provocando una desaceleración o frenado.  

Para conseguir desplazamientos en un periodo de tiempo corto, las fases de aceleración y frenado han de durar lo menos posible. El valor de la aceleración durante esas fases va a depender por un lado del coeficiente de adherencia de las ruedas, y por otro, de la posición del centro de gravedad del robot.


\subsection{Coeficiente de adherencia de las ruedas y su cálculo experimental}
\label{coeficiente_adherencia_y_calculo_experimental}

A partir del modelo dinámico descrito anteriormente, teniendo en cuenta que el robot dispone de dos ruedas (un motor por rueda) y a partir de la primera ley de Newton ($F = ma$) se deduce que la aceleración sobre el eje horizontal del robot se corresponde con la expresión:
\begin{equation}
  \label{eq:a_f_fx}
  a = \frac{2F_x}{m}
\end{equation}


La aceleración máxima vendrá dada por la fuerza máxima de propulsión de las ruedas $F_{x\,max}$ a partir de la cual se produce el deslizamiento de las ruedas. Por lo tanto ha de cumplirse la condición
\begin{equation}
  \label{eq:condicion_fx}
   F_x<F_{x\,max}
\end{equation}

siendo
\begin{equation}
  \label{eq:fx_max_f_ka}
  F_{x\,max} = K_a \, F_n,
\end{equation}

donde $K_a$ es el coeficiente de adherencia de las ruedas contra el suelo y toma valores teóricos ente 0 y 1:

$K_a=0$: adherencia nula

$K_a=1$: adherencia teórica máxima\footnote{En la practica el coeficiente de adherencia puede superar valores de uno, por ejemplo si existe una carga aerodinámica extra como ocurre en los coches de carreras de la F1.}.

El valor de $K_a$ depende del tipo de neumático utilizado y de la calidad y limpieza del campo de juego. Así para un neumático consistente en una junta tórica se consiguen valores de $K_a$ inferiores a $0,5$. En cambio un neumático de caucho de baja dureza (entre 20 y 30 shores) podría alcanzar valores de $K_a$ cercanos a 1. 

%El coeficiente de adherencia permite calcular, junto con la posición del centro de gravedad del robot, la aceleración máxima del mismo. 
El valor del coeficiente de adherencia se puede medir experimentalmente mediante el método propuesto por Jacques Coulon en \cite{rcva_10x}, conocido como el \emph{método del cubo}. 

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{metodo_cubo}
\caption[]{Medodo de medida del coeficiente de adherencia de las ruedas.}
\label{fig:metodo_cubo}
\end{figure}


Dicho método se encuentra representado en la figura \ref{fig:metodo_cubo} y consta de tres pasos:

\begin{enumerate}
\item Apoyar las ruedas del robot sobre una báscula manteniendo el robot horizontal. Para ello, ayudarse de un soporte sobre los puntos de apoyo del robot. El peso $P1$ medido por la bascula se corresponde con la fuerza con la que las ruedas apoyan en el suelo.
\item Bloquear las ruedas del robot\footnote{El boqueo ha de ser un bloqueo mecánico, en caso de bloquear las ruedas manteniendo la consigna de posición del robot el motor puede resultar gravemente dañado.} y fijar a la parte más baja y cercana al eje motriz una cuerda atada a un cubo. Hacer pasar la cuerda por una polea para disminuir el rozamiento y añadir peso al cubo hasta que las ruedas comiencen a deslizar.
\item Medir el peso $P2$ del cubo, el cual se corresponde con la fuerza de tracción máxima en el límite de deslizamiento.
\end{enumerate}

El coeficiente de adherencia viene dado por las medidas realizadas según la expresión
\begin{equation}
  \label{eq:ka=f(p1,p2)}
  \boxed{K_a = \frac{P2}{P1}}.
\end{equation}

Notar que el valor de $K_a$ es independiente del peso del robot.

La validez de este método se ha comprobado en la practica. El método se aplicó a robots de diferente peso y de ruedas idénticas obteniendo los resultados de la tabla siguiente:


\begin{table}[h]
\centering
\caption{Resultados de la medida del coeficiente de adherencia de las ruedas}
\label{tab:resultados_medida_ka}
\begin{tabular}{lccc}
\hline
Robot & $P1$ & $P2$ & $K_a$ \\
\hline
Zamorano (2011) 	& 14,5   & 15,6   & 1,076  \\
Automático (2012)   & 17,6   & 17,3   & 0,983  \\
\hline
\end{tabular}
\end{table}

Las ruedas de ambos robots se muestra en la figura \ref{fig:ruedas_foam_silicona}. Están construidas a partir de ruedas de coche de radio control de espuma, 60mm de diámetro y 45mm de ancho. Además se les ha añadido una capa de silicona para mejorar la adherencia. Este tipo de ruedas ha sido utilizado en todos los robots desarrollados desde el año 2011 dado su alto coeficiente de adherencia. 

\begin{figure}[h]
\centering
\includegraphics[height=.2\textheight]{ruedas_foam_silicona}
\caption[]{Ruedas utilizadas en los robots}
\label{fig:ruedas_foam_silicona}
\end{figure}


\subsection{Determinación de la aceleración máxima en las fases de aceleración y frenado}

La aceleración máxima durante las fases de aceleración o frenado depende de dos condiciones. La primera es la condición para la cual las ruedas derrapen o deslicen. Y la segunda, en caso de robots con ruedas atrás, es la condición para la cual el robot pierde contacto con el suelo en su parte delantera (como un caballo que se pone sobre sus patas trasera), pudiendo volcar hacia atrás.

Por otro lado, el valor de la aceleración máxima para cada condición depende del coeficiente de adherencia de las ruedas ($K_a$) y la posición del centro de gravedad del robot, respecto al eje motriz y los puntos de apoyo. 

A continuación describe como determinar el valor máximo de aceleración para los siguientes tipos de robot:

\begin{enumerate}
\item Robot con ruedas atrás
\item Robot con ruedas en el medio
\end{enumerate}

El desarrollo completo puede encontrarse en \cite{rcva_10x}. Aquí sólo se presentan los desarrollos que se han considerado importantes para el entendimiento la dinámica del robot y los resultados finales. Además, este trabajo añade el resultado para el caso de un robot con ruedas en el medio asimétrico, no estudiado en \cite{rcva_10x}.

\subsubsection{Robots con ruedas atrás}

Se parte del modelo dinámico del robot representado por la siguiente figura:

\begin{figure}[H]
\centering
\includegraphics[width=.4\textwidth]{dinamica_a_max_ruedas_atras}
\caption[]{Modelo dinámico en fase de aceleración y frenado para robots con ruedas atrás.}
\label{fig:dinamica_a_max_ruedas_atras}
\end{figure}

Donde:
\begin{description}
\item $G$: centro de gravedad del robot.
\item $F_x$: fuerza de propulsión de en la rueda.
\item $F1$: fuerza normal del suelo en la rueda.
\item $F2$: fuerza normal del suelo en el punto delantero.
\item $a$: aceleración del robot
\item $-mg$: fuerza de la gravedad aplicada en el centro de gravedad.
\item $d1$:  distancia entre el centro de gravedad y el eje motriz.
\item $d2$: distancia entre el centro de gravedad y el punto de apoyo delantero.
\item $d$: distancia entre el eje motriz y un punto de apoyo (d = d1 + d2).
\item $h$: altura del centro de gravedad del robot.
\end{description}

Las ecuaciones que garantiza que el sistema esta en equilibrio son las siguientes:	

\begin{description}
\item Suma de fuerzas verticales\\
\begin{equation}
\label{eq:suma_fuerzas_verticales}
2F1 + 2F2 - mg = 0
\end{equation}

\item Suma de fuerzas horizontales\\
\begin{equation}
\label{eq:suma_fuerzas_horizontales}
2F_x = ma
\end{equation}

\item Suma de torsiones aplicadas al punto G\\	
\begin{equation}
\label{eq:suma_torsiones_punto_g}
F2d2 - F1d1 + F_x \, h = 0
\end{equation}
\end{description}


A partir las ecuaciones \eqref{eq:suma_fuerzas_verticales}, \eqref{eq:suma_fuerzas_horizontales} y \eqref{eq:suma_torsiones_punto_g}	, se obtienen las ecuaciones que representan la distribución de pesos en las fases de aceleración y frenado:
\begin{align}
(2F1)/mg &= d2/d + (a/g)(h/d) \label{eq:distribucion_pesos_rueda}\\
(2F2)/mg &= d1/d - (a/g)(h/d) \label{eq:distribucion_pesos_apoyo}
\end{align}

Notar que el término $(2F1)/mg$ representa la distribución de pesos en el eje motriz, mientras que el termino $(2F2)/mg$ representa el reparto de pesos en la parte delantera. Los términos $d2/d$ y $d1/d$ representan las distribuciones de pesos en estático, cuando la aceleración es nula ($a=0$). Y el término  $(a/g)(h/d)$ representa la transferencia de masa del robot durante la aceleración o frenado.

Así pues, en fase de aceleración ($a>0$) la transferencia de masa se produce hacia la parte trasera del robot por lo que el robot avanza y tiende a hacer \emph{el caballito}. Mientras que en la fase de frenado ($a<0$) la transferencia de masa se produce hacia la parte delantera de forma que las ruedas tienen a deslizar o derrapar sobre el suelo.

Se deducen algunas conclusiones al respecto:

\begin{itemize}
\item Interesa tener el máximo apoyo en el eje motriz aumentando el termino $(2F1)/mg$ o el termino estático $d2/d$, de forma que el centro de gravedad esté lo más cerca posible del eje motriz.

\item Cuando el término de transferencia de masa dinámica $(a/g)(h/d)$ cambia de signo debido a la aceleración, se consiguen una buena fase de aceleración pero una fase peor de frenado.

\item Como los robots en un partido no hacer otra cosas que acelerar y frenar, interesa reducir lo máximo la transferencia de masa, la cual depende únicamente de la relación $(h/d)$. Por lo tanto interesa bajar el centro de gravedad lo máximo posible.
\end{itemize}


Continuando con el cálculo, la condición para no derrapar en la fase de aceleración viene dada por la ecuación \eqref{eq:fx_max_f_ka} expresada como 
\begin{equation}
\label{eq:condicion_derrape_aceleracion}
F_x < K_a \, F1
\end{equation}

y para la fase de frenado como
\begin{equation}
\label{eq:condicion_derrape_frenada}
|F_x| < K_a \, F1.
\end{equation}


Por otro lado, la condición para que el robot no haga \emph{el caballito} durante la fase de aceleración es
\begin{equation}
\label{eq:condicion_caballito_aceleracion}
F2 > 0
\end{equation}

y para la fase de frenado es
\begin{equation}
\label{eq:condicion_caballito_frenado}
F1 > 0
\end{equation}

A partir de las ecuaciones \eqref{eq:distribucion_pesos_rueda}, \eqref{eq:distribucion_pesos_apoyo}, \eqref{eq:suma_fuerzas_horizontales} y las condiciones mencionadas anteriormente se obtienen las aceleraciones máximas para cada fase y condición.

Fase de aceleración ($a>0$):
\begin{empheq}[box=\fbox]{align}
a_{max1} &= g\,\frac{K_a \, d2}{d-(K_a \, h)} \label{eq:a_max_aceleracion_derrape}\\
a_{max2} &= g\,\frac{d1}{h} \label{eq:a_max_aceleracion_caballito}
\end{empheq}


Fase de frenado ($a<0$):
\begin{empheq}[box=\fbox]{align}
a_{max1} &= g\,\frac{K_a \, d2}{d+(K_a \, h)} \label{eq:amax_frenado_derrape}\\
a_{max2} &= g\,\frac{d2}{h} \label{eq:amax_frenado_caballito}
\end{empheq}

Siendo $a_{max1}$ la aceleración máxima para no derrapar y $a_{max2}$ la aceleración máxima para no hacer \emph{el caballito}. Para cada fase, la aceleración máxima vendrá dada por el valor mínimo de estas:
\begin{equation}
\label{eq:a_aceleracion}
a_{max} = Min\{a_{max1}, a_{max2}\}.
\end{equation}


Por ejemplo, la figura \ref{fig:ejemplo_a_max} representa el caso de dos robots iguales excepto por la altura de su centro de gravedad.	

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{ejemplo_a_max}
\caption[]{Ejemplo de calculo de la aceleración máxima en las fases de aceleración y frenado}
\label{fig:ejemplo_a_max}
\end{figure}

Las aceleraciones máximas calculadas para estos robots se muestran en la tabla \ref{tab:ejemplo_a_max}.

\begin{table}[h]
\centering
\caption{Ejemplo de aceleraciones máximas en función del centro de gravedad}
\label{tab:ejemplo_a_max}

\begin{tabular}{ lcccc }
\hline
			& Aceleración R1 & Frenado R1 & Aceleración R2 & Frenado R2 \\
\hline
$a_{max1}$ 	& $1,2g$ 		& $0,4g$ 		& $3,0g$ 		& $0,3g$ 	\\
$a_{max2}$ 	& $0,8g$ 		& $1,2g$ 		& $0,5g$ 		& $0,75g$ 	\\
$a_{max}$ 	& $0,8g$ 		& $0,4g$ 		& $0,5g$ 		& $0,3g$ 	\\
			& ($8\,m/s$) 		& ($4\,m/s$) 		& ($5\,m/s$) 		& ($3\,m/s$)  \\
\hline
\end{tabular}

\end{table}

Observar que estos cálculos sólo se refieren a desplazamientos de translación y no a giros, permitiendo maximizar la aceleración. Que el robot sea capaz de alcanzar dicha aceleración va a depender de la elección de los motores y su reductora.

Por otro lado, hay que tener en cuenta que estos cálculos dependen únicamente del centro de gravedad del robot y del coeficiente de adherencia de las ruedas. El peso del robot no interviene.


\subsubsection{Robots con ruedas en el medio}

Un robot que tiene las ruedas en el medio puede ser que tenga su centro de gravedad exactamente sobre el eje motriz, de forma que el robot es simétrico. Si el centro de gravedad esta desplazado se habla de un robot asimétrico.

Los modelos dinámicos para estos casos se corresponden con la siguiente figura:

\begin{figure}[H]
\centering
\includegraphics[width=.8\textwidth]{dinamica_a_max_ruedas_medio}
\caption[]{Modelo dinámico fase de aceleración y frenado para robots con ruedas en el medio.}
\label{fig:dinamica_a_max_ruedas_medio}
\end{figure}

Donde:
\begin{description}
\item $G$: centro de gravedad del robot.
\item $F_x$: fuerza de propulsión de en la rueda.
\item $F1$: fuerza normal del suelo en la rueda.
\item $F2$: fuerza normal del suelo en el punto delantero.
\item $F3$: fuerza normal del suelo en el punto de apoyo trasero.
\item $a$: aceleración del robot
\item $-mg$: fuerza de la gravedad aplicada en el centro de gravedad.
\item $d1$: distancia entre el centro de gravedad y el eje motriz.
\item $d2$: distancia entre el centro de gravedad y el punto de apoyo trasero.
\item $d2'$: distancia entre el centro de gravedad y el punto de apoyo delantero.
\item $h$: altura del centro de gravedad del robot.
\end{description}

Para el caso del robot simétrico de la figura \ref{fig:dinamica_a_max_ruedas_atras} y siguiendo un análisis igual al realizado para robots con ruedas atrás, se obtienen las ecuaciones que definen las aceleraciones máximas. Debido a que el robot tiene 4 puntos de apoyo no es posible que éste haga \emph{el caballito}, por lo que la aceleración máxima vendrá dada únicamente para la condición de derrape de las ruedas y es la misma para las fases de aceleración y frenado dada la simetría del robot:
\begin{equation}
\label{eq:a_max_simetrico}
\boxed{a_{max} = g\,\frac{K_a}{1 + K_a\,(h/d2)}}
\end{equation}


Por otro lado, en el caso del robot asimétrico, el centro de gravedad cae entre el eje motriz y los puntos de apoyo de uno de los extremos del robot. Al igual que en el caso anterior la condición de hacer \emph{el caballito} no existe al tener el robot 4 puntos de apoyo. Sin embargo, la aceleración máxima es distinta para la fase de aceleración y la de frenado debido a la asimetría del robot.

Fase de aceleración ($a>0$):
\begin{equation}
\label{eq:a_max_pos_no_simetrico}
\boxed{a_{max} = g\,\frac{K_a}{(d1+d2)/d2 + K_a\,(h/d2)}}
\end{equation}


Fase de frenado ($a<0$):
\begin{equation}
\label{eq:a_max_neg_no_simetrico}
\boxed{a_{max} = g\,\frac{K_a}{(d2'-d1)/d2' + K_a\,(h/d2')}}
\end{equation}

Se comprueba que si $d1=0$, el modelo se corresponde con el de un robot simétrico y las ecuaciones \eqref{eq:a_max_pos_no_simetrico} y \eqref{eq:a_max_neg_no_simetrico} coinciden con la ecuación \eqref{eq:a_max_simetrico}.

\subsubsection{Medida del centro de gravedad del robot}

Se ha visto que para los cálculos de la aceleración máxima del robot es necesario conocer la posición del centro de gravedad del mismo. Su valor puede ser medido fácilmente utilizando una regla y una barra lo suficientemente larga. Por ejemplo para medir la altura del centro de gravedad se procedería a apoyar el robot sobre la barra por una de sus caras como muestra la figura \ref{fig:medida_centro_gravedad} hasta dar con una posición en la que el robot se encuentre en equilibrio. Una vez obtenida la posición de equilibrio se mide la distancia que hay de la base del robot al centro de la barra, la cual se corresponde con la altura del centro de gravedad. 

\begin{figure}[h]
\centering
\includegraphics[width=.4\textwidth]{medida_centro_gravedad}
\caption[]{Ejemplo de medida de la altura del centro de gravedad del robot}
\label{fig:medida_centro_gravedad}
\end{figure}

La operación se repite sobre la base del robot situando la barra paralela al eje motriz, de forma que se determina la distancia del centro de gravedad a dicho eje. Y por último, se puede realizar la medida con la barra situada perpendicularmente al eje motriz con el fin de comprobar que el robot es simétrico en dicho eje y que el peso soportado por cada rueda es el mismo.

\subsection{Perfil de velocidad trapezoidal}

Como ya se ha visto, el desplazamiento de un robot sobre un plano horizontal se divide en una fase de aceleración, otra de frenado y una fase intermedia de velocidad constante. Dichas fases se suelen implementar mediante un perfil trapezoidal de velocidad como el representado en la figura \ref{fig:perfil_trapezoidal}. 

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{perfil_trapezoidal}
\caption[]{Fases de un perfil trapezoidal de velocidad: aceleración, velocidad y distancia recorrida}
\label{fig:perfil_trapezoidal}
\end{figure}

%En dicho perfil se pueden identificar las fases de aceleración, velocidad constante y frenado. A cada una de estas fases le corresponde una distancia recorrida ($d1,d2,d3$) y un tiempo ($t1,t2,t3$).

Como se sabe, la optimización de dicho perfil pasa por la determinación de las aceleraciones y velocidad máximas. La aceleración máxima se corresponde con aquella para la que el robot se encuentre al limite del deslizamiento o de hacer \emph{el caballito} y se calcula de la forma que se ha descrito en la sección anterior. En la práctica, nunca se trabaja con la aceleración máxima teórica y si no que se utiliza una aceleración de seguridad que suele se el 80\% de la teórica:
\begin{equation}
\label{eq:a_seguridad}
a = 0.8\,a_{max}
\end{equation}

Respecto a la velocidad máxima, dependerá en última medida del motor y la reductora utilizada. No obstante, dadas las dimensiones del campo y que los robots han de ser capaces de evitar colisiones entre ellos, una velocidad de $1m/s$ suele ser un buen valor de compromiso.

Resulta interesante el análisis que hacen en \cite{rcva_10x} sobre el valor de la velocidad máxima. En este análisis se comparan dos perfiles trapezoidales de distinta velocidad ($1m/s$ y $1,4m/s$), de igual aceleración ($a=2\,m/s$) y para una misma distancia recorrida ($1m/s$). El resultado es que el perfil con velocidad de $1,4m/s$ tarda sólo $0,1s$ menos en recorrer la distancia de $1m$. Un tiempo que es despreciable. Esto es debido a que el tiempo de la fase de velocidad constante del perfil de $1.4m/s$ es muy pequeño respecto al tiempo que se invierte en acelerar y frenar. De esto se deduce que para distancias cortas no es tan importante la velocidad como la aceleración del robot.

Por último,respecto a la gráfica de distancia del perfil trapezoidal, se observa una evolución parabólica durante las fases de aceleración y frenado que permite un movimiento suave del robot. Como se verá en la sección \ref{sec:sitema_posicionamiento_relativo}, esta curva representa una consigna de distancia para el sistema de control de posición.

\subsection{Dimensionamiento del motor y su reductora}

Como se ha visto, las ruedas del eje motriz se encuentran conectadas al motor por medio de una reductora. La figura \ref{fig:modelo_reductora_motor} representa el modelo mecánico de uno de los motores. 

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{modelo_reductora_motor}
\caption[]{Modelo mecánico de uno de los motores del sistema de tracción diferencial.}
\label{fig:modelo_reductora_motor}
\end{figure}

Donde:
\begin{description}
\item $\omega_i$: velocidades angulares ($rad/s$)
\item $M_i$: par o momentos de fuerza ($N\,m$)
\item $P_i$: potencias mecánicas ($Nm/(rad/s)$)
\item $K$: relación de reducción de la reductora
\item $Rd$: rendimiento de la reductora
\item $D$: diámetro de la rueda
\end{description}

La potencia mecánica en el motor $P1$ y en el eje de salida de la reductora $P2$ viene dada como:
\begin{align}
P1 &= M1\,\omega1 \label{eq:potencia_mecanica_motor} \\
P2 &= M2\,\omega2 \label{eq:potencia_mecanica_reductora}
\end{align}

Dichas potencias se relacionan mediante la reductora de la siguiente manera:
\begin{align}
\omega2 &= \frac{\omega1}{K} \label{eq:relacion_w1_w1} \\
M2 &= M1\,Rd\,K \label{eq:relacion_M2_M1} \\
P2 &= P1\,Rd \label{eq:relacion_P2_P1} 
\end{align}

Observar que la relación entre potencias en \eqref{eq:relacion_P2_P1} no depende de $K$. Si $K$ aumenta el par de la reductora $M2$ aumenta pero la velocidad $w2$ disminuye.	

Por otro, del modelo en régimen permanente de un motor de corriente continua, se sabe que la tensión de armadura del motor $U$ y el par motor $M$ se corresponden con:
\begin{align}
U &= r\,i + K_v\,\omega \label{eq:tension_armadura} \\
M &= K_m\,i \label{eq:par_motor}
\end{align}

Siendo:
\begin{description}
\item $r$: resistencia de la armadura ($\Omega$)
\item $i$: corriente de la armadura (A)
\item $K_v:$ constante de fuerza electromecánica (V/(rad/s))
\item $K_m$: constante de par motor (Nm/A)
\end{description}

A la hora de dimensionar la reductora se busca determinar el valor de reducción ($K$) que genere un par suficiente en la rueda para vencer las fuerzas aplicadas en la misma que se oponen al movimiento.

No obstante existe una condición más restrictiva a la hora de dimensionar la reductora. Es el caso en el que las ruedas queden bloqueadas debido a que el robot se encuentra con un obstáculo imprevisto. Por ejemplo una pared debido a un error de posicionamiento, o que haya un objeto inesperado entre el robot y la pared. En ese caso el controlador de posición reaccionará aumentando la tensión del motor hasta su valor máximo $U_{max}$ (tensión de la batería) y se corre el riesgo de que el motor se queme. Este caso es analizado en \ref{rcva_10x} a partir de modelo térmico del motor. El análisis determina que en caso de bloqueo de una rueda la vida útil del motor es de 2,3s, a menos que el driver del motor sirva de fusible y se rompa antes o que exista un mecanismo de protección.

Teniendo en cuenta este caso, un dimensionamiento más correcto de la reductora es aquel que permita que las ruedas derrapen antes de que la tensión del motor alcance su valor máximo.

Por un lado se calcula el par en el motor $M1$ necesario para producir deslizamiento a partir del par en la rueda $M3$, el cual depende de a su vez la fuerza de propulsión máxima de las ruedas $F_{x\,max}$.
\begin{align}
M1 &= \frac{M3}{K\,Rd} \label{eq:M1} \\
M3 &= F_{x\,max}\,\frac{D}{2} \label{eq:M3} \\
F_{x\,max} &= \frac{K_a\,F1}{2} \label{eq:fx_max}
\end{align}

La fuerza aplicada sobre las ruedas $F1$ depende de la distribución de pesos sobre el eje motriz y se corresponde con el peso $P1$ medido durante el la medida experimental del coeficiente de adherencia $K_a$. De forma general $F1$ se calcula como:
\begin{equation}
F1 = mg\,\frac{d2}{d} \label{eq:F1}
\end{equation}

El par en el motor $M1$ resulta:
\begin{equation}
M1 = \frac{K_a\,mg\,(d2/d)}{K\,Rd\,D}
\end{equation}


Por otro lado, a partir de las ecuaciones del modelo del motor se obtiene el par máximo que puede dar el motor a la salida de la reductora $M2$:
\begin{align}
U &= U_{max} = Vbat \label{eq:Vbat} \\
i|_{\omega = 0} &= \frac{Vbat}{r} \label{eq:i_w_zero} \\
M2 &= K_m\,i = K_m\,\frac{Vbat}{r} \label{eq:M2}
\end{align}


La condición que garantiza el deslizamiento de las ruedas en una situación de bloqueo es que el par máximo del motor sea mayor que el par en el límite de deslizamiento de la rueda. Para asegurar dicha condición se añade un margen de un 20\% de forma que el deslizamiento sea apreciable:
\begin{equation}
M2 >= 1,2\,M1 \label{eq:condicion_kmin}
\end{equation}

El valor mínimo de la reductora $K_{min}$ se obtiene al sustituir \eqref{eq:M1} y \eqref{eq:M2} en \eqref{eq:condicion_kmin} y despejar $K$:
\begin{equation}
\boxed{K_{min} = 1,2\,\frac{K_a\,mg\,(d2/d)\,D\,r}{4\,K_m\,Rd\,Vbat}} \label{eq:kmin}
\end{equation}

Notar que $K_{min}$ aumenta si los términos $K_a\,F1$, $D$ o $r$ aumentan, o $K_m$, $U_{max}$ disminuye.

Por ejemplo, el sistema de tracción diferencial de la plataforma desatollada utiliza unos motores \emph{brushless} Dunkermotoren BG40x50 alimentados a 24V de 30W. Aunque no se trata de un motor de corriente continua se sabe por \cite{} que se puede modelizar como tal y que su funcionamiento queda representado por las mismas curvas del motor de continua como muestra la figura \ref{fig:motor_bg40x50_curvas}

\begin{figure}[h]
\centering
\includegraphics[width=.8\textwidth]{motor_bg40x50_curvas}
\caption[]{Curvas del motor Dunkermotoren BG40x50 24V dada por el fabricante.}
\label{fig:motor_bg40x50_curvas}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=.6\textwidth]{motor_bg40x50_tabla}
\caption[]{Parámetros del motor Dunkermotoren BG40x50 24V dadas por el fabricante.}
\label{fig:motor_bg40x50_tabla}
\end{figure}

A partir de los parámetros y curvas dadas por el fabricante (ver figura \ref{fig:motor_bg40x50_tabla} y \ref{fig:motor_bg40x50_curvas}) se deducen las variables necesarias para el cálculo de la reductora. La resistencia equivalente se obtiene de \eqref{eq:tension_armadura} a partir del la tensión nominal $U_n$ y la corriente de arranque $i_o$ como

$$r = \frac{U_n}{i_o} = \frac{24V}{8,4A} = 2,86\Omega$$

Por otro lado la constante mecánica $K_m$ se obtiene a partir de la pendiente de la recta $i=f(M)$ de la figura \ref{fig:motor_bg40x50_curvas} los puntos $(M_n, i_n)$ y $(M_o, i_o)$ como:

$$ K_m = \frac{M_o - M_n}{i_o - i_n} =  \frac{(37,4-8)[Ncm]}{(8,4-2,1)[A]} \times \frac{1[m]}{100[cm]} = 46,7 mN\,m/A $$

Además según el fabricante las reductoras compatibles para esta motor tienen un rendimiento $Rd$ de un 90\% hasta valores de $K=8$


Para el caso del robot P.Tinto (Eurobot 2015) sus datos son:
\begin{align*}
m &= 15 Kg\\
D &= 0,6 m\\
d &= 0,131 m\\
d2 &= 0,112 m\\
K_a &= 1\\
\end{align*}

Por último, sustituyendo en \eqref{eq:kmin} se obtiene un valor de 
$$K_{min} = 6,37.$$ 
Puesto que es menor que 8 el rendimiento utilizado de la reductora es válido. La reductora del fabricante de valor cercano por exceso es la reductora PLG42S 8:1. 

En el caso real, ya se disponían de estos motores y además ya venían con una reductora PLG42S de factor de reducción 4:1\footnote{Estos motores se compraron en el año 2010 a un vendedor de eBay. Los motores nuevos son caros y por que entonces no había presupuesto suficiente para comprar unos nuevos a demanda de los requisitos del robot.}. Se optó por añadir una segunda etapa de reducción. Esta segunda etapa se implemento mediante una reducción por correa dentada, cuyo rendimiento es del 90\%. Recalculando $K_{min}$ para un rendimiento de $0,9²$ se obtiene una 
$$K_{min} = 7.$$	

A partir de este valor, se escogió un factor de reducción 2:1 para la segunda etapa.

\subsection{Dimensionamiento de los motores}

elección de la velocidad y la aceleración

\subsection{Resultados experimentales}

\section{Sistema de control de posición}
\label{sec:sitema_posicionamiento_relativo}


El control de los motores se realiza de forma indirecta utilizando las medida de posición de las ruedas libres.


Esta configuración difiere de la configuración clásica en la que el encoder se encuentra conectado directamente al eje del motor. Dichas ruedas libres se utilizan para implementar el sistema de posicionamiento mediante odometría, la configuración del encoder desacoplado del motor permite mejorar el error acumulado de posicionamiento debido al derrape de las ruedas motrices.



El desplazamiento del robot debido a las ruedas motrices es medida mediante encoders conectados a ruedas libres alineadas con las ruedas motrices. De esta forma se mide la posición de cada motor de forma indirecta e independiente de si las ruedas de tracción derrapan.


Al no estar conectado el encoder directamente al eje del motor, la medida obtenida es independiente de la tracción de la rueda con el el suelo. 




El control de posición es de tipo polar, es decir la posición del robot en todo momento viene dada por su distancia $d$ y ángulo $a$ absoluto respecto a un origen de coordenadas. 

\subsection{Control en posición de tipo polar}
\label{sec:control_posicion_tipo_polar}
\subsection{Ajuste del controlador PID}

\subsection{Detección de bloqueos mecánicos}
\label{sec:deteccion_bloqueos_mecanicos}



\subsection{Posicionamiento relativo mediante odometría}
\label{sec:posicionamiento_relativo_mediante_odometria}

\subsection{Medida y corrección de errores sistemáticos}
\subsection{Compensación de la fuerza centrípeta}



\section{Sistema de detección de obstáculos}
\label{sec:sistema_deteccion_obstaculos}

\subsection{Sistemas detección de obstáculos}
\subsection{Detección de oponentes mediante baliza tipo faro}




\section{Sistema de generación de trayectorias}
\label{sec:generacion_de_trayectorias}

\section{Sistema de evitación de obstáculos}
\label{sec:evitacion_de_obstaculos}






%%% Local Variables:
%%% TeX-master: "../book"
%%% End:
